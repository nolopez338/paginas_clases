<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Juego de N√∫meros Antiguos</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #38bdf8;
        --success: #22c55e;
        --danger: #f87171;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(1200px 800px at 70% -20%, #1f2937 0%, var(--bg) 60%);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans,
          Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        padding: 18px;
      }
      .card {
        width: min(780px, 94vw);
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
        padding: 26px;
      }
      h1 { margin: 0 0 8px; font-weight: 800; }
      p.sub { margin: 0 0 16px; color: var(--muted); }
      .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; margin: 14px 0; }
      .choices { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
      .chip { padding: 10px 12px; border-radius: 12px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.12); cursor: pointer; }
      .chip input { margin-right: 8px; accent-color: var(--accent); }
      button {
        padding: 14px 18px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.14);
        background: linear-gradient(180deg, #0ea5e9, #0284c7);
        color: white;
        font-weight: 700;
        cursor: pointer;
      }
      button.secondary { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.1); font-weight: 600; }
      .status { display: grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap: 12px; margin: 16px 0; }
      .pill { padding: 10px 12px; border-radius: 12px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); color: var(--muted); }
      .pill strong { color: var(--text); }
      .display { margin: 18px 0 12px; padding: 18px; border-radius: 16px; background: rgba(2, 6, 23, 0.55); border: 1px solid rgba(255,255,255,0.08); }
      .label { color: var(--muted); font-size: 14px; }
      .numeral { font-size: clamp(28px, 6vw, 46px); font-weight: 800; letter-spacing: 1.2px; word-break: break-word; }
      .egyptian { font-size: clamp(60px, 10vw, 100px); }
      input[type="number"] { width: 100%; padding: 14px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(17,24,39,0.65); color: var(--text); font-size: 16px; outline: none; }
      .feedback { margin-top: 12px; min-height: 24px; }
      .feedback.ok { color: var(--success); }
      .feedback.error { color: var(--danger); }
      .range { color: var(--muted); font-size: 14px; margin: 6px 0 0; }
      details { margin-top: 18px; border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 12px 14px; background: rgba(255,255,255,0.02); }
      details summary { cursor: pointer; font-weight: 700; }
      .reference { display: grid; gap: 8px; margin-top: 10px; }
      .reference-row { display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center; }
      .reference-row .symbol { font-size: 24px; font-weight: 800; }
      .leaderboard { margin-top: 18px; border-top: 1px solid rgba(255,255,255,0.06); padding-top: 12px; }
      .leaderboard h3 { margin: 0 0 6px; }
      .leaderboard ol { padding-left: 18px; margin: 0; color: var(--muted); }
      .leaderboard li strong { color: var(--text); }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Juego de numeraci√≥n antigua</h1>
      <p class="sub">Elige un sistema num√©rico y escribe el n√∫mero decimal que corresponde al s√≠mbolo mostrado. Son 10 niveles por partida.</p>

      <div class="choices" role="radiogroup" aria-label="Sistema num√©rico">
        <label class="chip"><input type="radio" name="system" value="romano" checked /> N√∫meros romanos (1‚Äì3999)</label>
        <label class="chip"><input type="radio" name="system" value="egipcio" /> N√∫meros egipcios (1‚Äì9,999,999)</label>
        <button id="start" type="button">Iniciar partida</button>
      </div>
      <p class="range" id="rangeText">Actualmente jugando con n√∫meros romanos (1‚Äì3999).</p>

      <div class="status">
        <div class="pill">Nivel: <strong id="level">‚Äî</strong></div>
        <div class="pill">Puntaje: <strong id="score">0</strong> / 10</div>
        <div class="pill">Rango nivel: <strong id="intervalo">1 y 3999</strong></div>
        <div class="pill">Tiempo: <strong id="timer">00:00</strong></div>
      </div>

      <section class="display">
        <div class="label">N√∫mero a convertir</div>
        <div id="numeral" class="numeral">Presiona ¬´Iniciar partida¬ª</div>
      </section>

      <div class="row">
        <input id="answer" type="number" min="1" step="1" placeholder="Escribe el n√∫mero decimal" aria-label="Tu respuesta" />
        <button id="submit" type="button" class="secondary">Responder</button>
      </div>
      <div id="feedback" class="feedback"></div>

      <details open>
        <summary>Referencia r√°pida del sistema elegido</summary>
        <div id="reference" class="reference"></div>
      </details>

      <section class="leaderboard">
        <h3>Tabla de r√©cords locales</h3>
        <ol id="leaderboard"></ol>
      </section>
    </main>

    <script>
      const totalLevels = 10;
      const ranges = {
        romano: { min: 1, max: 3999 },
        egipcio: { min: 1, max: 9_999_999 }
      };

      const state = {
        system: 'romano',
        level: 0,
        score: 0,
        target: null,
        finished: false,
        timerId: null,
        startedAt: null,
        elapsedMs: 0,
        currentRange: ranges.romano
      };

      const references = {
        romano: [
          { symbol: 'I, V, X, L, C, D, M', meaning: 'Unidades del 1 al 1000 que se combinan en orden descendente para sumar valores.' },
          { symbol: 'IV, IX, XL, XC, CD, CM', meaning: 'Combinaciones sustractivas para escribir 4, 9, 40, 90, 400 y 900.' },
          { symbol: 'Regla', meaning: 'No se repite m√°s de 3 veces el mismo s√≠mbolo seguido (salvo M que puede extender el valor).' }
        ],
        egipcio: [
          { symbol: 'ìÅ®', meaning: '1,000,000 (hombre con los brazos en alto)' },
          { symbol: 'ìÖ®', meaning: '100,000 (renacuajo)' },
          { symbol: 'ìÇ≠', meaning: '10,000 (dedo)' },
          { symbol: 'ìÜº', meaning: '1,000 (flor de loto)' },
          { symbol: 'ìç¢', meaning: '100 (espiral de cuerda)' },
          { symbol: 'ìéÜ', meaning: '10 (muesca)' },
          { symbol: 'ìè∫', meaning: '1 (trazo)' }
        ]
      };

      function toRoman(n) {
        if (n < 1 || n > 3999) return '‚Äî';
        const map = [
          [1000, 'M'], [900, 'CM'], [500, 'D'], [400, 'CD'],
          [100, 'C'], [90, 'XC'], [50, 'L'], [40, 'XL'],
          [10, 'X'], [9, 'IX'], [5, 'V'], [4, 'IV'], [1, 'I'],
        ];
        let num = n, out = '';
        for (const [val, sym] of map) {
          while (num >= val) { out += sym; num -= val; }
        }
        return out;
      }

      function toEgyptian(n) {
        if (n < 1) return '‚Äî';
        const symbols = {
          1_000_000: 'ìÅ®',
          100_000: 'ìÖ®',
          10_000: 'ìÇ≠',
          1_000: 'ìÜº',
          100: 'ìç¢',
          10: 'ìéÜ',
          1: 'ìè∫'
        };
        let out = '';
        for (const val of [1_000_000, 100_000, 10_000, 1_000, 100, 10, 1]) {
          out += symbols[val].repeat(Math.floor(n / val));
          n %= val;
        }
        return out;
      }

      const levelEl = document.querySelector('#level');
      const scoreEl = document.querySelector('#score');
      const numeralEl = document.querySelector('#numeral');
      const answerEl = document.querySelector('#answer');
      const feedbackEl = document.querySelector('#feedback');
      const startBtn = document.querySelector('#start');
      const submitBtn = document.querySelector('#submit');
      const rangeText = document.querySelector('#rangeText');
      const intervalo = document.querySelector('#intervalo');
      const timerEl = document.querySelector('#timer');
      const referenceEl = document.querySelector('#reference');
      const leaderboardEl = document.querySelector('#leaderboard');

      function randomBetween(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function getLevelRange(system, level) {
        const { min, max } = ranges[system];
        const span = max - min;
        const startFactor = Math.max(0, (level - 1) / totalLevels);
        const endFactor = level / totalLevels;
        const levelMin = Math.floor(min + span * startFactor * 0.8);
        const levelMax = Math.max(levelMin + 1, Math.floor(min + span * endFactor));
        return { min: levelMin, max: levelMax };
      }

      function updateRangeText() {
        const { min, max } = ranges[state.system];
        rangeText.textContent = `Actualmente jugando con n√∫meros ${state.system === 'romano' ? 'romanos' : 'egipcios'} (${min.toLocaleString('es-ES')}‚Äì${max.toLocaleString('es-ES')}).`;
        const range = getLevelRange(state.system, Math.max(1, state.level || 1));
        state.currentRange = range;
        intervalo.textContent = `${range.min.toLocaleString('es-ES')} y ${range.max.toLocaleString('es-ES')}`;
      }

      function renderNumeral() {
        const numeral = state.system === 'romano' ? toRoman(state.target) : toEgyptian(state.target);
        numeralEl.textContent = numeral;
        numeralEl.classList.toggle('egyptian', state.system === 'egipcio');
        numeralEl.classList.toggle('numeral', true);
      }

      function startGame() {
        stopTimer();
        state.level = 1;
        state.score = 0;
        state.finished = false;
        feedbackEl.textContent = '';
        feedbackEl.className = 'feedback';
        startBtn.textContent = 'Reiniciar partida';
        startTimer();
        generateTarget();
        renderStatus();
        renderNumeral();
        answerEl.value = '';
        answerEl.focus();
      }

      function generateTarget() {
        const range = getLevelRange(state.system, state.level || 1);
        state.currentRange = range;
        state.target = randomBetween(range.min, range.max);
        intervalo.textContent = `${range.min.toLocaleString('es-ES')} y ${range.max.toLocaleString('es-ES')}`;
      }

      function renderStatus() {
        levelEl.textContent = state.finished ? '‚Äî' : `${state.level} / ${totalLevels}`;
        scoreEl.textContent = state.score;
      }

      function finishGame() {
        state.finished = true;
        stopTimer();
        numeralEl.textContent = '¬°Juego terminado!';
        numeralEl.classList.remove('egyptian');
        feedbackEl.textContent = `Tu puntaje final es ${state.score} de ${totalLevels}.`;
        feedbackEl.className = 'feedback';
        levelEl.textContent = '‚Äî';
        updateLeaderboard();
      }

      function startTimer() {
        state.startedAt = Date.now();
        state.elapsedMs = 0;
        timerEl.textContent = '00:00';
        state.timerId = setInterval(() => {
          const elapsed = Date.now() - state.startedAt;
          state.elapsedMs = elapsed;
          timerEl.textContent = formatTime(elapsed);
        }, 500);
      }

      function stopTimer() {
        if (state.timerId) {
          clearInterval(state.timerId);
          state.timerId = null;
        }
      }

      function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        return `${minutes}:${seconds}`;
      }

      function renderReference() {
        const rows = references[state.system]
          .map(item => `<div class="reference-row"><div class="symbol">${item.symbol}</div><div>${item.meaning}</div></div>`) 
          .join('');
        referenceEl.innerHTML = rows;
      }

      function loadLeaderboard() {
        try {
          return JSON.parse(localStorage.getItem('numerosLeaderboard') || '[]');
        } catch (_) {
          return [];
        }
      }

      function saveLeaderboard(entries) {
        localStorage.setItem('numerosLeaderboard', JSON.stringify(entries));
      }

      function updateLeaderboard() {
        const entries = loadLeaderboard();
        entries.push({
          system: state.system,
          score: state.score,
          duration: state.elapsedMs,
          playedAt: new Date().toISOString()
        });

        const sorted = entries.sort((a, b) => {
          if (b.score !== a.score) return b.score - a.score;
          return a.duration - b.duration;
        }).slice(0, 5);

        saveLeaderboard(sorted);
        renderLeaderboard(sorted);
      }

      function renderLeaderboard(existing = loadLeaderboard()) {
        if (!existing.length) {
          leaderboardEl.innerHTML = '<li>No hay partidas guardadas a√∫n.</li>';
          return;
        }

        leaderboardEl.innerHTML = existing
          .map(entry => `<li><strong>${entry.score}/${totalLevels}</strong> en ${formatTime(entry.duration)} ¬∑ ${entry.system}</li>`)
          .join('');
      }

      function handleAnswer() {
        if (state.level === 0 || state.finished) return;
        const value = answerEl.value.trim();
        if (!value) {
          feedbackEl.textContent = 'Escribe un n√∫mero entero mayor que 0.';
          feedbackEl.className = 'feedback error';
          return;
        }
        const n = Number(value);
        if (!Number.isInteger(n) || n < 1) {
          feedbackEl.textContent = 'Solo se aceptan enteros positivos.';
          feedbackEl.className = 'feedback error';
          return;
        }

        if (n === state.target) {
          state.score += 1;
          feedbackEl.textContent = '¬°Correcto!';
          feedbackEl.className = 'feedback ok';
        } else {
          feedbackEl.textContent = `Respuesta incorrecta. El valor era ${state.target.toLocaleString('es-ES')}.`;
          feedbackEl.className = 'feedback error';
        }

        if (state.level >= totalLevels) {
          renderStatus();
          finishGame();
          return;
        }

        state.level += 1;
        generateTarget();
        renderStatus();
        renderNumeral();
        answerEl.value = '';
        answerEl.focus();
      }

      document.querySelectorAll('input[name="system"]').forEach(radio => {
        radio.addEventListener('change', () => {
          state.system = radio.value;
          updateRangeText();
          renderReference();
          renderLeaderboard();
          if (state.level === 0 || state.finished) {
            numeralEl.textContent = 'Presiona ¬´Iniciar partida¬ª';
            numeralEl.classList.toggle('egyptian', state.system === 'egipcio');
          }
        });
      });

      startBtn.addEventListener('click', startGame);
      submitBtn.addEventListener('click', handleAnswer);
      answerEl.addEventListener('keydown', e => { if (e.key === 'Enter') handleAnswer(); });

      updateRangeText();
      renderReference();
      renderLeaderboard();
    </script>
  </body>
</html>
