<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Matrix Grid Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b132b;
      --panel:#1c2541;
      --ink:#e6eefc;
      --muted:#a8b3c7;

      --floor:#9aa3b2;  /* 0: Floor */
      --wall:#0f172a;   /* 6: Wall */

      /* Coins 1–5 */
      --coin1:#f5c542;  /* gold */
      --coin2:#c0c7d1;  /* silver */
      --coin3:#22c55e;  /* green */
      --coin4:#ef4444;  /* red */
      --coin5:#a855f7;  /* purple */

      --robot:#3aa6ff;  /* 9: Robot */
      --cell-size: 34px;
      --gap: 2px;
      --radius: 6px;
    }

    *{ box-sizing: border-box; }
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
    }

    header{ padding:16px; text-align:center; }

    main{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:16px;
      padding:16px;
      align-items:start;
    }

    .card{
      background:var(--panel);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:12px;
      padding:12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }

    .controls h2, .preview h2 { margin: 6px 0 10px; font-size: 16px; color: var(--muted); }

    textarea{
      width:100%;
      min-height:160px;
      resize:vertical;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background:#0a1026;
      color:var(--ink);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      line-height:1.4;
    }

    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      margin-top:10px;
    }

    button{
      border:none;
      background:linear-gradient(180deg, #3aa6ff, #2b86d1);
      color:white;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
    }
    button:active{ transform: translateY(1px); }

    .error{
      display:none;
      background:#3b1a1a;
      color:#ffd6d6;
      border:1px solid #ff6b6b33;
      border-radius:8px;
      padding:10px;
      margin-top:10px;
      white-space:pre-wrap;
      font-size: 14px;
    }

    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:8px 14px;
      margin-top:10px;
      font-size:14px;
      color:var(--muted);
    }
    .legend .item{ display:flex; align-items:center; gap:6px; }
    .swatch{
      width:18px; height:18px; border-radius:4px; border:1px solid rgba(0,0,0,.35);
      display:inline-block;
    }
    .coin-dot{
      width:18px; height:18px; border-radius:50%; border:1px solid rgba(0,0,0,.35); display:inline-block;
    }

    .grid-wrap{
      overflow:auto;
      padding:8px;
      border-radius:10px;
      background:#0a1026;
      border:1px solid rgba(255,255,255,0.10);
      max-height:70vh;
    }
    .grid{
      display:grid;
      gap:var(--gap);
    }
    .cell{
      width:var(--cell-size);
      height:var(--cell-size);
      border-radius:var(--radius);
      display:grid;
      place-items:center;
      font-size:18px;
      user-select:none;
    }
    .floor{ background: var(--floor); }
    .wall{ background: var(--wall); }

    .robot{
      background: var(--floor);
      outline: 2px solid var(--robot);
      outline-offset: -2px;
      color: var(--robot);
      font-size: 22px;
    }

    .coin{
      background: var(--floor);
      position:relative;
    }
    .coin::after{
      content:"";
      width:65%; height:65%;
      border-radius:50%;
      border:2px solid rgba(0,0,0,0.25);
      justify-self:center;
      align-self:center;
    }
    .coin.c1::after{ background: var(--coin1); }
    .coin.c2::after{ background: var(--coin2); }
    .coin.c3::after{ background: var(--coin3); }
    .coin.c4::after{ background: var(--coin4); }
    .coin.c5::after{ background: var(--coin5); }

    .stats{ margin-top:8px; font-size:13px; color:var(--muted); }
    .footer-note{ margin-top:10px; font-size:12px; color:var(--muted); }

    @media (max-width: 880px){
      main{ grid-template-columns: 1fr; }
      .grid-wrap{ max-height: 50vh; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Matrix Grid Viewer</h1>
    <div class="footer-note">
      Values — 0: Floor | 1–5: Coins | 6: Wall | 9: Robot start
    </div>
  </header>

  <main>
    <section class="card controls" aria-labelledby="controls-title">
      <h2 id="controls-title">Input</h2>

      <label for="matrixInput" style="display:block; margin-bottom:6px;">
        Matrix (rows by newline; space-separated numbers — commas also work)
      </label>
      <textarea id="matrixInput" spellcheck="false" placeholder="Example:
1 0 9
2 3 3
1 1 0"></textarea>

      <div class="row">
        <button id="renderBtn" aria-label="Render grid from matrix">Render Grid</button>
        <label style="display:flex; align-items:center; gap:8px;">
          Cell
          <input id="cellSize" type="range" min="18" max="54" value="34" />
          <span id="cellSizeVal" aria-live="polite">34px</span>
        </label>
      </div>

      <div id="errorBox" class="error" role="alert"></div>

      <div class="legend" aria-label="Legend">
        <div class="item"><span class="swatch" style="background:var(--floor)"></span> 0 Floor</div>
        <div class="item"><span class="coin-dot" style="background:var(--coin1)"></span> 1 Coin</div>
        <div class="item"><span class="coin-dot" style="background:var(--coin2)"></span> 2 Coin</div>
        <div class="item"><span class="coin-dot" style="background:var(--coin3)"></span> 3 Coin</div>
        <div class="item"><span class="coin-dot" style="background:var(--coin4)"></span> 4 Coin</div>
        <div class="item"><span class="coin-dot" style="background:var(--coin5)"></span> 5 Coin</div>
        <div class="item"><span class="swatch" style="background:var(--wall)"></span> 6 Wall</div>
        <div class="item"><span class="swatch" style="background:var(--floor); outline:2px solid var(--robot)"></span> 9 Robot</div>
      </div>

      <div class="stats" id="stats">Pickups: 1:0  2:0  3:0  4:0  5:0</div>
      <div class="footer-note">Controls: Arrow keys to move/turn, 1–5 to pick up matching coin.</div>
    </section>

    <section class="card preview" aria-labelledby="preview-title">
      <h2 id="preview-title">Preview</h2>
      <div class="grid-wrap" id="gridWrap" tabindex="0" aria-label="Grid keyboard focus area">
        <div id="grid" class="grid" role="grid" aria-label="Matrix grid"></div>
      </div>
    </section>
  </main>

  <script>
    "use strict";

    const matrixInput = document.getElementById("matrixInput");
    const renderBtn = document.getElementById("renderBtn");
    const grid = document.getElementById("grid");
    const gridWrap = document.getElementById("gridWrap");
    const errorBox = document.getElementById("errorBox");
    const cellSize = document.getElementById("cellSize");
    const cellSizeVal = document.getElementById("cellSizeVal");
    const statsEl = document.getElementById("stats");

    const coinClass = { 1:"c1", 2:"c2", 3:"c3", 4:"c4", 5:"c5" };

    // robot + matrix state
    let matrix = null;
    let rows = 0, cols = 0;
    const robot = { r: -1, c: -1, dir: 0 }; // 0=right, 90=down, 180=left, 270=up
    const pickups = { 1:0, 2:0, 3:0, 4:0, 5:0 };

    function showError(msg){
      errorBox.textContent = msg;
      errorBox.style.display = "block";
    }
    function clearError(){
      errorBox.textContent = "";
      errorBox.style.display = "none";
    }
    function updateStats(){
      statsEl.textContent = `Pickups: 1:${pickups[1]}  2:${pickups[2]}  3:${pickups[3]}  4:${pickups[4]}  5:${pickups[5]}`;
    }

    // Parsing (spaces/commas/tabs)
    function parseMatrix(text){
      const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      if(lines.length === 0) throw new Error("No rows found.");

      const rows = lines.map((line, idx) => {
        const parts = line.split(/[,\s]+/).filter(Boolean);
        if(parts.length === 0) throw new Error(`Row ${idx+1} is empty.`);
        const nums = parts.map((p, j) => {
          if(!/^-?\d+$/.test(p)) throw new Error(`Invalid token "${p}" at row ${idx+1}, col ${j+1}.`);
          return Number(p);
        });
        return nums;
      });

      const width = rows[0].length;
      for(let r=1; r<rows.length; r++){
        if(rows[r].length !== width){
          throw new Error(`Matrix is not rectangular. Row 1 has length ${width}, row ${r+1} has ${rows[r].length}.`);
        }
      }

      const allowed = new Set([0,1,2,3,4,5,6,9]);
      for(let i=0; i<rows.length; i++){
        for(let j=0; j<rows[i].length; j++){
          const v = rows[i][j];
          if(!allowed.has(v)){
            throw new Error(`Disallowed value ${v} at row ${i+1}, col ${j+1}. Allowed: 0,1,2,3,4,5,6,9`);
          }
        }
      }
      return rows;
    }

    function idx(r,c){ return r*cols + c; }

    function drawCell(r,c){
      const cell = grid.children[idx(r,c)];
      cell.className = "cell";
      cell.textContent = "";

      const v = matrix[r][c];
      if(v === 6){
        cell.classList.add("wall");
      } else if(v >= 1 && v <= 5){
        cell.classList.add("coin", coinClass[v]);
      } else {
        cell.classList.add("floor");
      }
    }

    function drawRobot(){
      const cell = grid.children[idx(robot.r, robot.c)];
      cell.className = "cell robot";
      cell.textContent = arrowForDir(robot.dir);
      cell.style.transform = "none";   // no rotation needed anymore
    }

    function arrowForDir(deg){
      const d = ((deg % 360) + 360) % 360;
      if (d === 0)   return "▶"; // right
      if (d === 90)  return "▼"; // down
      if (d === 180) return "◀"; // left
      return "▲";                // up (270)
    }


    function renderGrid(m){
      matrix = m;
      rows = matrix.length;
      cols = matrix[0].length;

      // find robot start (9), then make the underlying cell a floor (0)
      let found = false;
      for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
          if(matrix[r][c] === 9 && !found){
            robot.r = r; robot.c = c; robot.dir = 0; // facing right
            matrix[r][c] = 0;
            found = true;
          }
        }
      }
      if(!found) throw new Error("Robot start (9) not found.");

      grid.innerHTML = "";
      grid.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
      for(let i=0; i<rows; i++){
        for(let j=0; j<cols; j++){
          const cell = document.createElement("div");
          cell.className = "cell";
          grid.appendChild(cell);
          drawCell(i,j);
        }
      }
      drawRobot();
      updateStats();
      gridWrap.focus();
    }

    function dirToDelta(deg){
      const d = ((deg % 360) + 360) % 360;
      if(d === 0)   return {dr: 0, dc: 1};   // right
      if(d === 90)  return {dr: 1, dc: 0};   // down
      if(d === 180) return {dr: 0, dc: -1};  // left
      if(d === 270) return {dr: -1, dc: 0};  // up
      return {dr: 0, dc: 1}; // fallback to right
    }

    function canEnter(r,c){
      return !(r < 0 || r >= rows || c < 0 || c >= cols || matrix[r][c] === 6);
    }

    // Movement: positive = forward, negative = backward (relative to facing)
    function move(steps){
      const s = Math.sign(steps);
      const count = Math.abs(steps);
      if(s === 0) return;

      const {dr, dc} = dirToDelta(robot.dir);
      const step = { dr: dr * s, dc: dc * s };

      for(let k=0; k<count; k++){
        const nr = robot.r + step.dr;
        const nc = robot.c + step.dc;
        if(!canEnter(nr, nc)) break;

        // redraw old underlying cell
        drawCell(robot.r, robot.c);

        // move
        robot.r = nr; robot.c = nc;

        // draw robot at new cell
        drawRobot();
      }
    }

    function turn(deltaDeg){
      robot.dir = ((robot.dir + deltaDeg) % 360 + 360) % 360;
      drawRobot();
    }

    function pickupCoin(kind){
      if(kind < 1 || kind > 5) return;
      const v = matrix[robot.r][robot.c];
      if(v === kind){
        matrix[robot.r][robot.c] = 0;
        pickups[kind] += 1;
        drawCell(robot.r, robot.c);
        drawRobot();
        updateStats();
      }
    }

    // Keyboard controls
    function handleKey(e){
      const active = document.activeElement;
      const isTyping = active && (active.tagName === "TEXTAREA" || (active.tagName === "INPUT" && active.type !== "range"));
      if(isTyping) return;
      if(!matrix) return;

      const arrows = ["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];
      if(arrows.includes(e.key)) e.preventDefault(); // avoid scrolling

      switch(e.key){
        case "ArrowUp":   move(1); break;
        case "ArrowDown": move(-1); break;
        case "ArrowLeft": turn(-90); break;
        case "ArrowRight":turn(90); break;
        case "1": case "2": case "3": case "4": case "5":
          pickupCoin(Number(e.key));
          break;
      }
    }

    renderBtn.addEventListener("click", () => {
      clearError();
      try{
        const m = parseMatrix(matrixInput.value);
        renderGrid(m);
      }catch(err){
        showError(err.message || String(err));
      }
    });

    cellSize.addEventListener("input", () => {
      const px = `${cellSize.value}px`;
      document.documentElement.style.setProperty("--cell-size", px);
      cellSizeVal.textContent = px;
    });

    window.addEventListener("keydown", handleKey);
    gridWrap.addEventListener("click", () => gridWrap.focus());
  </script>
</body>
</html>
