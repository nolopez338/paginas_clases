<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake â€” Juego en pantalla completa</title>
  <style>
    html,body{
      height:100%;margin:0;
      background:#000;
      display:flex;align-items:center;justify-content:center;
    }
    canvas{
      background:#071826;
      display:block;
      width:95vw;
      height:95vh;
    }
    #score{
      position:absolute;top:10px;left:50%;transform:translateX(-50%);
      color:#fff;font-family:sans-serif;font-size:20px;
    }
  </style>
</head>
<body>
  <div id="score">Puntos: 0</div>
  <canvas id="game"></canvas>

  <script>
    (function(){
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const scoreEl = document.getElementById('score');

      let tileSize = 20;
      function resize(){
        canvas.width = Math.floor(window.innerWidth / tileSize) * tileSize;
        canvas.height = Math.floor(window.innerHeight / tileSize) * tileSize;
      }
      window.addEventListener('resize', resize);
      resize();

      let cols = canvas.width / tileSize;
      let rows = canvas.height / tileSize;

      let snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
      let dir = {x:1, y:0};
      let nextDir = {x:1, y:0};
      let apple = null;
      let score = 0;

      function placeApple(){
        let x,y,collision;
        do{
          x = Math.floor(Math.random()*cols);
          y = Math.floor(Math.random()*rows);
          collision = snake.some(s=>s.x===x && s.y===y);
        }while(collision);
        apple = {x,y};
      }

      function update(){
        dir = nextDir;
        let head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

        // Wrap-around en vez de morir
        if(head.x < 0) head.x = cols-1;
        if(head.x >= cols) head.x = 0;
        if(head.y < 0) head.y = rows-1;
        if(head.y >= rows) head.y = 0;

        if(snake.some(seg => seg.x===head.x && seg.y===head.y)){
          reset();
          return;
        }

        snake.unshift(head);
        if(head.x === apple.x && head.y === apple.y){
          score += 10;
          placeApple();
        } else {
          snake.pop();
        }
        scoreEl.textContent = "Puntos: " + score;
      }

      function draw(){
        ctx.fillStyle = '#071826';
        ctx.fillRect(0,0,canvas.width,canvas.height);

        // manzana
        ctx.fillStyle = 'red';
        ctx.fillRect(apple.x*tileSize, apple.y*tileSize, tileSize, tileSize);

        // serpiente
        ctx.fillStyle = 'lime';
        for(let s of snake){
          ctx.fillRect(s.x*tileSize, s.y*tileSize, tileSize-1, tileSize-1);
        }
      }

      function loop(){
        update();
        draw();
      }

      function setNextDir(x,y){
        if(dir.x === -x && dir.y === -y) return;
        nextDir = {x,y};
      }

      window.addEventListener('keydown', e=>{



        if(['ArrowUp','w','W'].includes(e.key)) setNextDir(0,-1);
        if(['ArrowDown','s','S'].includes(e.key)) setNextDir(0,1);
        if(['ArrowLeft','a','A'].includes(e.key)) setNextDir(-1,0);
        if(['ArrowRight','d','D'].includes(e.key)) setNextDir(1,0);
      });

      function reset(){
        snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
        dir = {x:1, y:0};
        nextDir = {x:1, y:0};
        score = 0;
        placeApple();
      }

      placeApple();
      setInterval(loop, 100);
    })();
  </script>
</body>
</html>
